<div class="panel panel-primary" >
	<div class="panel-heading" >
		<h4 class="text-center">歷年課程</h4>
	</div>
	
	<br>
	<div id="ggaa" class="container">
	</div>
</div>
<script>
$(document).ready(function(){
	$.getJSON("/user/all_courses2?uid=<%=params[:uid] %>", function (data) {
		$("#ggaa").html(tmpl("gg8", data));
		
		console.log(data);
	});
	
});

</script>


<script type="text/x-tmpl" id="gg8">
{%= o.length %}
{% if (o.agreed.length > 0){ %}
	<table class="table table-bordered"style="border:0px">
		<tr class="row">
			<th class="col-md-"><h4 class="text-center">抵免科目<h4></th>
		</tr>
	{% for (var i=0, course; course=o.agreed[i]; i++) { %}
		<tr class="row">
			<td class="col-md-">
				<h4 class="text-center">
				{%=course.cf_name%} | 
				{%=course.name%} | 
				{%=course.cos_type%} | 
				<%= fa_icon "graduation-cap", class:"credit-count" %><strong>{%=course.credit%}</strong>
				</h4>
			</td>
		</tr>
	{% } %}
	</table>
{% } %}

<table class="table table-hover " id="by_cos_type">
	{% var grouped=groupBy(o.taked,function(item){return item.cos_type;}); %}
	{% var credits={}; %}
	{% for (var i=0, courses; courses=grouped[i]; i++) { %}
		
		{% var local_credit=0;%}
		<tr class="row">
			<th colspan="3" class="{%=cos_type_class(courses[0].cos_type)%}">
				{%=courses[0].cos_type%}
			</th>
		</tr>

		{% for (var j=0, course; course=courses[j]; j++) { %}
			{% var pass_class=""; %}
			{% if(course.pass) { %}
			{% local_credit+=parseInt(course.credit); %}
			{% } else{ %}
			{% pass_class="danger"; %}
			{% } %}
			<tr class="row {%=pass_class%}">
				<td class="col-md-6">
					<h4 class="text-center">
						<a href="/courses/{%=course.cos_id%}?tid={%=course.t_id%}">{%=course.name%}</a> | 
						{%=course.t_name%} | 
						<%= fa_icon "graduation-cap", class:"credit-count" %> <strong>{%=course.credit%}</strong>
					</h4>
				</td>
				<td class="col-md-6">
						<div class="container" style="display:inline-block;">		
							<a href="/courses/{%=course.cos_id%}?tid={%=course.t_id%}&first_show=files" class="btn btn-sm btn-default">考古題</a>
							<div class="number-right-top" >{%=course.file_count%}</div>
							<a href="/courses/{%=course.cos_id%}?tid={%=course.t_id%}&first_show=discussion" class="btn btn-sm btn-default">討論區</a>
							<div class="number-right-top" >{%=course.discuss_count%}</div>
						</div>
					</td>
			</tr>
		{% } %}
		{% credits[courses[0].cos_type]=local_credit; %}
	{% } %}
	<tr class="row label-info">
		<td colspan="2" >
			<h4 class="text-right">
				歷年總和:
				{% for (var value in credits){ %}
					{%=value%} : <strong>{%=credits[value]%}</strong>
				{% } %}
				
			</h4>
		</td>
	</tr>

</table>
</script>
