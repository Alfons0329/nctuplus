
<%= render :partial=>"search_js2" %>

<div class="form-inline" ><!--role="form"-->
	<div class="row">

		<div class="form-group col-sm-2  col-sm-offset-1">
			
			<div class="input-group">
				<!--<span class="input-group-addon">
					<input type="checkbox" id="semester_check">
				</span>-->
				<div class="cleaninput" onclick='clean_input($(this))'><%=fa_icon "times"%></div>
				<input type="text" class="form-control" id="semester_select" placeholder="選擇學期..." value="<%=latest_semester.name%>">
				<input type="hidden" id="semester_id" value="<%= session[:saved_query][:sem_id]||Semester.all.last.id%>" >
				<div class="input-group-btn">
					<button type="button" class="btn btn-default " id="semester" onclick="select_thing('semester')">
						<span class="caret"></span>
					</button>
				</div>	<!-- /btn-group -->
			</div>	<!-- /input-group --> 
		</div>	<!-- /form-group -->
		
		<div class="form-group col-sm-2 ">
			<div class="input-group">
				<!--<span class="input-group-addon">
					<input type="checkbox" id="department_check">
				</span>-->
				<div class="cleaninput" onclick='clean_input($(this))'><%=fa_icon "times"%></div>
				<input type="text" class="form-control" id="degree_select" placeholder="大學部/研究所/通識" ><!--readonly-->
				<input type="hidden" id="degree_id" value="" >
	      <div class="input-group-btn">
					<button type="button" class="btn btn-default " id="department" onclick="select_thing('degree')">
						<span class="caret"></span>
					</button>

				</div>	<!-- /btn-group -->
			</div>	<!-- /input-group --> 
		</div>	<!-- /form-group -->
		
	  <div class="form-group col-sm-3 ">
			<div class="input-group">
				<!--<span class="input-group-addon">
					<input type="checkbox" id="department_check">
				</span>-->
				<div class="cleaninput" onclick='clean_input($(this))'><%=fa_icon "times"%></div>
				<input type="text" class="form-control" id="department_select" placeholder="選擇系所..." >
				<input type="hidden" id="department_id" value="<%=session[:saved_query][:dept_id]%>" >
	      <div class="input-group-btn">
					<button type="button" class="btn btn-default" id="department" onclick="select_thing('department')">
						<span class="caret"></span>
					</button>
				</div>	<!-- /btn-group -->
			</div>	<!-- /input-group --> 
		</div>	<!-- /form-group -->
		
		<!--<div class="form-group col-sm-3 ">
			<div class="input-group">
				
				<div class="input-group-btn">
					<button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" id="search_action">課名 <span class="caret"></span></button>
					<ul class="dropdown-menu">
						<li><a href="javascript:void(0);" onclick="change_search_type($(this))" id="course_name">課名</a></li>
						<li><a href="javascript:void(0);" onclick="change_search_type($(this))" id="course_time">時間</a></li>
						<li><a href="javascript:void(0);" onclick="change_search_type($(this))" id="course_teacher">老師</a></li>
					</ul>
				</div>
				<div class="cleaninput" onclick='clean_input($(this))'><%=fa_icon "times"%></div>
				<input type="hidden" id="search_type" value="course_name">
				<input type="text" class="form-control" id="search_term" placeholder="Search..." >
				
				<span class="input-group-btn">
					<button id="search-btn" class="btn btn-default" onclick="search_keyword()"><span class="glyphicon glyphicon-search"></span></button>
				</span>

			</div>
		</div>
		<div class="col-md-1">
		<span class="glyphicon glyphicon-question-sign clickable-hover text-right" style="color:green !important; "onclick="show_tip('search_tips')"></span>
		</div>-->
	</div><!-- /row -->
	
	
</div>
<br>
<div class="row">
			<div class="form-group col-sm-4 col-md-offset-4">
			<div class="input-group">
				
				<div class="input-group-btn">
					<button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" id="search_action">課名 <span class="caret"></span></button>
					<ul class="dropdown-menu">
						<li><a href="javascript:void(0);" onclick="change_search_type($(this))" id="course_name">課名</a></li>
						<li><a href="javascript:void(0);" onclick="change_search_type($(this))" id="course_time">時間</a></li>
						<li><a href="javascript:void(0);" onclick="change_search_type($(this))" id="course_teacher">老師</a></li>
					</ul>
				</div><!-- /btn-group -->
				<div class="cleaninput" onclick='clean_input($(this))'><%=fa_icon "times"%></div>
				<input type="hidden" id="search_type" value="course_name">
				<input type="text" class="form-control" id="search_term" placeholder="Search..." >
				
				<span class="input-group-btn"><!--type="submit"-->
					<button id="search-btn" class="btn btn-default" onclick="search_keyword()"><span class="glyphicon glyphicon-search"></span></button>
				</span>

			</div><!-- /input-group -->
		</div>

</div>


<div class="row hidden " id="search_tips">
	<div id="" class="col-md-10 col-md-offset-1">
		<div class="bs-callout bs-callout-info ">
			<!--<h4></h4>-->
			<p>快速鍵: 選擇類別-[U]ndergraduate:大學部 [G]raduate:研究所 [C]ommon:通識 [D]epartment:系所 [/]:關鍵字</p>
			<p>搜尋規則: 1CD 5G=>找含有1CD與5G時段的課程(OR) 1CD5G=>找1CD5G的課程(AND) </p>
		</div>
	</div>
</div>

<table class="table table-hover table-bordered" id="course_table" >



<tr class="row">
<th class="col-md-1">學期
<% select_tag("sort_by", options_for_select([['綜合','all'],['涼度','cold'],['甜度','sweety'],['硬度','hardness']]),  :style=>"height :25px;width:60px; ", :onchange=>"reorder($(this))") %>
</th>
<th class="col-md-2">系所/摘要</th>
<!--<th>永久課號</th>-->

<th class="col-md-2">課名</th>
<th class="col-md-1">老師</th>
<th class="col-md-4">備註</th>
<th class="col-md-1">時間</th>
<th class="col-md-1">學分</th>
<!--<th class="col-md-1"></th>-->
</tr>

	<% if !@cd_all.empty? %>
		<% @cd_all.each do |cd,course,teacher| %>
				<tr id="<%=cd.id%>" class="row clickable-row clickable-hover" href="<%=course_path(course, :tid=>teacher.id)%>">
					<td>
						<%=cd.semester.name%>
					</td>
					<td>
						<%=course.department.ch_name%>
						<% if cd.brief!=" " %>
						/<%= cd.brief %>
						<% end %>
					</td>
					<!--<td><%= cd.brief %></td>-->
					<!--<td><%= link_to course.real_id, course_path(course) %></td>-->
					<td><%= course.ch_name %></td>
					<td><%= teacher.name %></td>
					<td><%= cd.memo %></td>
					<td><%= cd.time %></td>
					<td><%= cd.credit %></td>
				</tr>
		<% end %>
	<% else %>
		<tr class="row"><td colspan="7" class="col-md-12"><h4>查無結果!</h4></td></tr>
	<% end %>
</table>

<div id="page-selection" class="text-center"></div>

<script>
$(document).ready(function($) {
	$(".clickable-row").click(function() {
		window.document.location = $(this).attr("href");
		//window.open($(this).attr("href"));
	});

	//alert("<%=j session[:saved_query].to_s.html_safe%>");
});

function reorder(obj){
	
	$(".rating").addClass("hidden");
	$("."+obj.val()).removeClass("hidden");
	var courses=[];
	var title;

	$("tr").each(function (index) {
		if(index==0){
			title=$.trim($(this).html());		
			return;
		}
		var innerhash={};
		var key=$.trim($(this).find('.'+obj.val()).text());
		if(key=="NaN")key=0;
		innerhash[key]=$.trim($(this).html());
		courses.push(innerhash);
		$.trim($(this).remove());

	});
	courses.sort(function(a, b){return Object.keys(b)[0]-Object.keys(a)[0]});

	for(var i=0;i<courses.length;i++){
		$("#course_table").append("<tr>"+courses[i][Object.keys(courses[i])[0]]+"</tr>");
	}

	
}



$('#page-selection').bootpag({
		total: <%=@page_numbers%>,
		<% if params[:page] %>
		page: <%=params[:page]%>,
		<% end %>
		maxVisible: 10
	}).on("page", function(event, num){
		<% case @table_type %>
		<% when "all" %>
			$("#search_result").load("/courses/list_all_courses?page="+num);
		<% when "search_by_dept" %>
			$("#search_result").load(
				"/courses/search_by_dept",
				{	view_type: '<%=@view_type%>',
					dept_id : '<%=session[:saved_query][:dept_id]%>',
					sem_id : '<%=session[:saved_query][:sem_id]%>',
					page : num
				}
			);
		<% else %>
			$("#search_result").load(
			"/courses/search_by_keyword",
			{ view_type : "<%=@view_type%>",
				search_term: '<%=session[:saved_query][:term]%>',
				search_type: '<%=session[:saved_query][:search_type]%>',
				sem_id :'<%=session[:saved_query][:sem_id]%>',
				dept_id : '<%=session[:saved_query][:dept_id]%>',
				degree_id : '<%=session[:saved_query][:degree]%>',
				page : num
			}
		);
		<% end %>
	});
</script>


