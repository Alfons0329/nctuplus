<%= stylesheet_link_tag "events_show", media: "all", "data-turbolinks-track" => true %>

<div id="content-container" class="">

	<!-- Main Contents -->
	<div class="main-column-wrapper row">
		<div class="main-column">
		
			<div class="image-wrapper">
				<%=image_tag @event.cover.url, width:"100%" %>
			</div>
			<span class="event-title">[<%=@event.event_type%>] <%=@event.title%></span>
			
			<!-- Contents of Main Column -->
			<div class="main-column-content">
				<!-- Info of Address -->
				<address class="main-column-info row">
					<!--<div class="col-xs-9 col-md-10">
						<p><%=fa_icon "calendar"%> 時間: <strong><%=@event.begin_time%> ~ <%=@event.end_time%></p>
						<p><%=fa_icon "cubes"%> 主辦單位: <%=@event.organization%></p>
					</div>-->
					<div class="col-xs-12 col-md-12">
						<p><%=fa_icon "calendar"%> 時間: <strong><%=@event.begin_time%> ~ <%=@event.end_time%></strong></p>
					</div>
					<div class="col-xs-12 col-md-12">
						<p><%=fa_icon "cubes"%> 主辦單位: <%=@event.organization%></p>
					</div>
					<div class="col-xs-12 col-md-12">
						<p><%=fa_icon "location-arrow"%> 地點: <%=@event.location%></p>
					</div>
				<% if @event.url.present? %>
					<div class="col-xs-12 col-md-12">
						<p><%=fa_icon "share-alt"%> 活動網址: <%=link_to "點這裡",@event.url,target:"blank"%></p>
					</div>
				<% end %>
				</address>
				<!-- Info of Address End -->
				
				<!-- Intro of Contents -->
				<section id="content">
					<div class="divide-horizontal">
						<span>活動介紹</span>
					</div>
					<%=@event.content.html_safe%>
				</section>
				<!-- Intro of Contents End -->
			</div>
			<!-- Contents of Main Column End -->
		</div>
	</div>
	<!-- Main Contents End -->
	
	<!-- Nav Menu, always on bottom -->
	<div class="nav-menu-wrapper navbar-fixed-bottom">
		<div class="container">
			<!-- Editor Nav -->
				<% if current_user&& @event.user_id==current_user.try(:id)%>
					<div id="editor-nav" class="nav-menu">
						<b>主辦選單 </b>
						<%=link_to "編輯",edit_event_path(@event),class:"btn btn-info nav-button",style:"width:30%;","data-no-turbolink"=>true%>	
						<%=link_to "刪除",@event,class:"btn btn-danger nav-button",style:"width:30%;",method:"delete", data: { confirm: '確定要刪除此活動嗎?' }%>
					</div>
				<% end %>
			<!-- Editor Nav End -->
			
			<!-- Normal Nav -->
			<div id="my-nav" class="nav-menu pull-right" >
				<% if current_user %>
					<div class="dropdown hidden"><!-- dropdown menu -->
						<button id="event-dropdown-menu" class="btn btn-default dropdown-toggle nav-button" type="button" data-toggle="dropdown" aria-expanded="true" style="width:40%">
							已參加活動
							<spen class="caret"></span>
						</button>
						<ul class="dropdown-menu" role="menu">
							<% current_user.attend_events.each do |myEvent| %>
								<li><%=link_to truncate(myEvent.title, length:10 ), "/events/"+myEvent.id.to_s %></li>
							<% end %>
						</ul>
					</div><!-- dropdown menu End -->
				<% end %>
			
				<button id="attend_button" class="btn btn-success nav-button" onclick="attend(<%=params[:id]%>);" style="width:40%">
					<% if current_user %>
						<% if @event.attendances.where(:user_id=>current_user.id).empty?%>
							參加
						<%else%>
							退出
						<%end%>
					<% else %>
						參加
					<% end %>
				</button>
			</div>
			<!-- Normal Nav End -->
		</div>
	</div>
	<!-- Nav Menu End-->
</div>

<!-- js functions -->
<script>
	$(document).ready(function(){
		
	});
	
	function attend(id){
		<% if current_user %>
			$.ajax({
				type:"POST",
				url:"/events/attend",
				data:{
					event_id: id
				},			
				success:function(data){
					if (data.state == "new"){
						toastr["info"]("已加入活動");
						$("#attend_button").text("退出");
					}
					else{
						toastr["info"]("已退出活動");
						$("#attend_button").text("參加");
					}
				},
				error:function(data){
					toastr["info"]("錯誤!");
				}
			});
		<% else %>
			toastr["info"]("請先登入, 謝謝");
		<% end %>
	}
	
</script>
<!-- js functions end -->
