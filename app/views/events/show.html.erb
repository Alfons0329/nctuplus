<%= stylesheet_link_tag "events_show", media: "all", "data-turbolinks-track" => true %>

<div id="content-container" class="layout-content">
	<div class="row">	
		<!-- Left Nav Menu -->
		<div class="nav-menu-wrapper">
		
			<!-- Nav always on top -->
			<div data-spy="affix">
				<!--% if current_user %-->
				<!--% @events.each do |event| %-->
					<!--% if event.where(:user_id==current_user.try(:id))%-->
						<div id="editor-nav" class="nav-menu" style="background-color: rgba(240, 240, 240, 1);" >
							<b>編輯功能區</b>
							<button id="edit_button" class="btn btn-info nav-button-wrapper" onclick="edit(<%=params[:id]%>);" style="width: 100%">編輯</button>
							<button id="edit_button" class="btn btn-danger nav-button-wrapper" onclick="edit(<%=params[:id]%>);" style="width: 100%">刪除</button>
						</div>
					<!--% end %-->
				<!--% end %-->
				<!--% end %-->
				<div id="my-nav" class="nav-menu" >	
					<button id="attend_button" class="btn btn-primary nav-button-wrapper" onclick="attend(<%=params[:id]%>);" style="width: 100%">
						<% if current_user %>
							<% if @event.attendances.where(:user_id=>current_user.id).empty?%>
								參加
							<%else%>
								退出
							<%end%>
						<% else %>
							參加
						<% end %>
					</button>
					<% if current_user %>
						<div class="divide-horizontal">
							<span style="color: black;">已參加的活動</span>
						</div>
						<ul>
							<% current_user.attend_events.each do |myEvent| %>
								<li><%=link_to truncate(myEvent.title, length:10 ), "/events/"+myEvent.id.to_s %></li>
							<% end %>
						</ul>
					<% end %>
				</div>
			</div>
		</div>
		<!-- Left Nav Menu End-->
		
		<!-- Right Main Contents -->
		<div class="main-column-wrapper">
			<div class="main-column">
			
				<div class="image-wrapper">
					<%=image_tag @event.cover.url, width:"100%" %>
				</div>
				<span class="event-title">[<%=@event.event_type%>] <%=@event.title%></span>
				
				<!-- Contents of Main Column -->
				<div class="main-column-content">
					<!-- Info of Address -->
					<address class="main-column-info row">
						<div class="col-xs-9 col-md-10">
							<p><%=fa_icon "calendar"%> 時間: <%=@event.begin_time%>~<%=@event.end_time%></p>
							<p><%=fa_icon "cubes"%> 主辦單位: <%=@event.organization%></p>
						</div>
						<div class="col-xs-3 col-md-2">
							<p><%=fa_icon "location-arrow"%> 地點: <%=@event.location%></p>
						</div>
					</address>
					<!-- Info of Address End -->
					
					<!-- Intro of Contents -->
					<section id="content">
						<div class="divide-horizontal">
							<span>活動介紹</span>
						</div>
						<%=@event.content.html_safe%>
					</section>
					<!-- Intro of Contents End -->
				</div>
				<!-- Contents of Main Column End -->
			</div>
		</div>
		<!-- Right Main Contents End -->
	</div>
</div>

<!-- js functions -->
<script>
	$(document).ready(function(){
		
	});
	
	function attend(id){
		<% if current_user %>
			$.ajax({
				type:"POST",
				url:"/events/attend",
				data:{
					event_id: id
				},			
				success:function(data){
					if (data.state == "new"){
						toastr["info"]("已加入活動");
						$("#attend_button").text("退出");
					}
					else{
						toastr["info"]("已退出活動");
						$("#attend_button").text("參加");
					}
				},
				error:function(data){
					toastr["info"]("錯誤!");
				}
			});
		<% else %>
			toastr["info"]("請先登入, 謝謝");
		<% end %>
	}
	
</script>
<!-- js functions end -->
